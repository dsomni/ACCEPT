<!DOCTYPE html>
<html>
    <head>
        <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <%= n_name %></title>

        <meta charset="utf-8">
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0,
              maximum-scale=1.0, minimum-scale=1.0,
              user-scalable=no, minimal-ui">
        <meta name="full-screen" content="yes">

        <link rel="stylesheet" href="/public/css/layout.css" type="text/css">
        </head>
    <body>
        <main>
            <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç <%= n_name %></h1>
            <% if(!isTeacher){ %>
            <p>–ö–ª–∞—Å—Å: <%= user.grade + user.gradeLetter %></p>
            <p>–ì—Ä—É–ø–ø–∞: <%= user.group %></p>
            <% } %>
            <form class="SearchUI" action= <%= '/account/'+ u_login +'/1/default' %>  method="POST">
                <input id="searcharea" name = "searcharea" rows=1 placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–¥–∞—á–µ"></input><button id="submitsearch">–ù–∞–π—Ç–∏</button>
                <select name="selector" id = "selector"> 
                    <option value="all" selected>–í—Å–µ –ø–æ—Å—ã–ª–∫–∏</option>
                    <option value="oks" >–¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ</option>
                </select>
            </form>

            <table class='taskslist'>
                <tr>
                  <th>–î–∞—Ç–∞</th>
                  <th>–ó–∞–¥–∞—á–∞</th>
                  <th>–í–µ—Ä–¥–∏–∫—Ç</th>
                  </tr>
                <% var onPage = 10 %>
                <% min = function(a,b){ if(a < b) return a; return b} %>
                <% for (var i = (page-1)*onPage; i < min(page*onPage,attempts.length); i++) { %>
                <% var attempt = attempts[i]; %>
                <% var task = tasks[i]; %>

                <% var item = attempt.result.find(el => el[2]=="er"); %>
                <% if(!item) { %>
                <% item = attempt.result[attempt.result.length - 1]; %>
                <% }%>
                <% if(!item || item[0]=='') item = ["üò°","Don't spam F5 during testing!!!", "er"]; %>
                <% var maxDate = new Date(Number(attempt.date)); %>
                <% var isoDate = maxDate.toISOString(); %>   
                <% var date = isoDate.substr(0, 10) + " " + isoDate.substr(11, 8) ; %>
                 <tr>
                  <td> <a class="tlrefs" href=<%="/attempt/" + u_login + '/' +  attempt.date  %>> <%= date %> </a> </td>
                  <td> <a class="tlrefs" href=<%="/task/" + task.identificator %>> <%= task.title %> </a> </td>
                  <td><%= item[0] %> <a id=<%= item[2] %>><%= item[1] %></a></td>
                 </tr>
                <% } %>
                </table>

                <% var page = Number(page) %>
                <% var prevPage = page - 1 %>
                <% var nextPage = page + 1 %>

                <div class="pageinfo">
                <div><%= ((page-1)*onPage+1).toString() + " - " +  min(page*onPage,attempts.length).toString() + " –∏–∑ " +  attempts.length.toString() %> </div>

                <% if(page>1) { %>
                    <button onClick=<%= 'location.href=\"/account/' + u_login + "/" +prevPage + "/" + search + "\"" %>>&lt;&lt;&lt;</button>
                <% }else { %>
                    <button>&lt;&lt;&lt;</button>
                <% } %>
                <% if(page*onPage<attempts.length) { %>
                    <button onClick=<%= 'location.href=\"/account/'+ u_login + "/" +nextPage + "/" + search + "\"" %>>&gt;&gt;&gt;</button>
                <% }else { %>
                    <button>&gt;&gt;&gt;</button>
                <% } %>
                </div>
        </main>
    </body>
</html>